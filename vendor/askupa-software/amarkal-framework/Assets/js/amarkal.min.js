/**
 * Package: amarkal
 * Version: 0.1.0
 * Date: 2015-01-20
 */
jQuery(document).ready(function(a){function b(){}b.Notifier={},b.Notifier.top=32,b.Notifier.notifications=[],b.Notifier.notify=function(c,d){var e=document.createElement("div"),f=document.createElement("p"),g=document.createElement("div");e.setAttribute("class","ao-notification notifier-"+d),g.setAttribute("class","ao-notification-button fa fa-times"),e.appendChild(f),e.appendChild(g),f.innerHTML=c,a(g).click(function(){b.Notifier.removeNotification(e)}),a(e).css({top:b.Notifier.top+"px"}),a(".amarkal-options").append(e),b.Notifier.top+=a(e).outerHeight()+10,b.Notifier.notifications.push(e)},b.Notifier.success=function(a){b.Notifier.notify(a,"success")},b.Notifier.error=function(a){b.Notifier.notify(a,"error")},b.Notifier.removeNotification=function(c){var d=b.Notifier.notifications.indexOf(c),e=a(c).outerHeight()+10;for(b.Notifier.top-=e,c.parentNode.removeChild(c),b.Notifier.notifications.splice(d,1);d<b.Notifier.notifications.length;d++)a(b.Notifier.notifications[d]).animate({top:"-="+e})},b.Options={},b.Options.formID="ao-form",b.Options.init=function(){b.Options.Sections.init(),a(".form-control-button").click(function(c){c.preventDefault(),c.stopPropagation(),b.Options[a(this).attr("data-action")]()});for(var c=b.Options.State.get("notifications"),d=0;d<c.length&&c;d++)b.Notifier.notify(c[d].message,c[d].type);for(var e=b.Options.State.get("errors"),d=0;d<e.length&&e;d++){var f=b.Options.Sections.getByID(e[d].section);f.addNotification(e[d].message)}a(".amarkal-options .append-control-menu").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).parent().hasClass("active")?a(".form-control-button").removeClass("active"):(a(".form-control-button").removeClass("active"),a(this).parent().toggleClass("active"))}),a('[data-type="help"]').tooltip({delay:{show:0,hide:250}})},b.Options.save=function(){b.Options.State.set("action","save"),b.Options.submit()},b.Options.reset=function(){b.Options.State.set("action","reset-all"),b.Options.submit()},b.Options.resetSection=function(){b.Options.State.set("action","reset-section"),b.Options.submit()},b.Options.export=function(){b.Notifier.success("This feature is not yet implemented.")},b.Options.exportAs=function(){b.Notifier.success("This feature is not yet implemented.")},b.Options.import=function(){b.Notifier.success("This feature is not yet implemented.")},b.Options.submit=function(){a("#"+b.Options.formID).submit()},b.Options.Section=function(b){this.id=b,this.button=a('[data-section="'+this.id+'"]'),this.triangleEl=a('<i class="fa fa-exclamation-triangle"></i>'),this.circleEl=a('<span class="number"></span>'),this.noticePanel=a("#"+b).find(".section-notifications"),this.notices=[],this.updated=[],this.subsections=[],this.init()},b.Options.Section.prototype.init=function(){this.button.append(this.triangleEl,this.circleEl),this.circleEl.hide(),this.triangleEl.hide();var b=this;a("#"+this.id).find(".field-wrapper").change(function(){a(this).addClass("field-updated"),b.updated.push(a(this).attr("for")),a.unique(b.updated),b.circleEl.text(b.updated.length),b.circleEl.show()}),a("#"+this.id+" .sub-menu a").each(function(){a(this).click(function(c){c.preventDefault(),b.hideAllSubsections(),b.showSubsection(a(this).attr("href"))}),b.subsections.push(a(this).attr("href"))}),this.hideAllSubsections(),this.showSubsection(this.subsections[0])},b.Options.Section.prototype.show=function(){b.Options.State.set("active_section",this.id),this.button.addClass("active"),a("#"+this.id).show()},b.Options.Section.prototype.hide=function(){this.button.removeClass("active"),a("#"+this.id).hide()},b.Options.Section.prototype.showSubsection=function(b){a('[href="'+b+'"]').addClass("active"),a('[data-subsection="'+b+'"]').show()},b.Options.Section.prototype.hideAllSubsections=function(){a("#"+this.id+" .sub-menu a").each(function(){a(this).removeClass("active"),a('[data-subsection="'+a(this).attr("href")+'"]').hide()})},b.Options.Section.prototype.addNotification=function(a){this.notices.push(a),this.triangleEl.show();for(var b="",c=0;c<this.notices.length;c++)b+="<p>"+this.notices[c]+"</p>";this.noticePanel.html(b)},b.Options.Section.prototype.clearNotifications=function(){this.triangleEl.hide(),this.notices=[]},b.Options.Sections={},b.Options.Sections.sectionList=[],b.Options.Sections.init=function(){a(".amarkal-options .section").each(function(){var c=new b.Options.Section(a(this).attr("id"));b.Options.Sections.sectionList.push(c),c.hide(),c.id===b.Options.State.get("active_section")&&c.show()}),a("[data-section]").click(function(c){c.preventDefault(),b.Options.Sections.hideAll(),b.Options.Sections.getByID(a(this).attr("data-section")).show(),a("#"+b.Options.formID).attr("action",a(this).attr("href"))})},b.Options.Sections.getByID=function(a){for(var c=0;c<b.Options.Sections.sectionList.length;c++){var d=b.Options.Sections.sectionList[c];if(d.id===a)return d}},b.Options.Sections.hideAll=function(){for(var a=0;a<b.Options.Sections.sectionList.length;a++)b.Options.Sections.sectionList[a].hide()},b.Options.State={},b.Options.State.inputID="options-state",b.Options.State.data=a.parseJSON(a("#"+b.Options.State.inputID).val()),b.Options.State.set=function(a,c){b.Options.State.data[a]=c,b.Options.State.update()},b.Options.State.get=function(a){var c=b.Options.State.data;return null!==c&&c.hasOwnProperty(a)?c[a]:!1},b.Options.State.update=function(){a("#options-state").val(JSON.stringify(b.Options.State.data))},b.UI={},b.UI.components=[],b.UI.init=function(){for(var c=0;c<b.UI.components.length;c++){var d=b.UI.components[c];a(d.wrapper).each(function(){d.init(this),a(d.getInput(this)).change(function(){var b=a(this).parents(".afw-ui-component");b.trigger("change"),b.attr("data-value",a(this).val())})})}},b.UI.register=function(a){b.UI.components.push(a)},b.UI.register({wrapper:".afw-ui-composite-component",getInput:function(b){return a(b).children("input")},init:function(b){a(b).find(".afw-ui-component").change(function(){var b=a(this).parent().parent().children("input"),c=a(this).parent().parent().find(".afw-ui-component"),d=b.attr("data-template");b.val(d);for(var e=0;e<c.length;e++){var f=b.val(),g=a(c[e]);b.val(f.replace("<% "+g.attr("data-name")+" %>",g.attr("data-value")))}})}}),b.UI.register({wrapper:".afw-ui-component-dropdown",getInput:function(b){return a(b).children("select")},init:function(b){a(b).children("select").select2({width:"resolve"}).change(function(){a(this).parents(".afw-ui-component").trigger("change")})}}),b.UI.register({wrapper:".afw-ui-component-slider",getInput:function(b){return a(b).children("input")},init:function(b){var c=parseFloat(a(b).attr("data-max")),d=parseFloat(a(b).attr("data-min")),e=parseFloat(a(b).attr("data-step")),f=a(b).attr("data-type"),g=a(b).hasClass("afw-ui-component-disabled");if("range"===f){var h=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:!0,disabled:g,values:[parseInt(h[0].value),parseInt(h[1].value)],slide:function(a,b){h[0].value=b.values[0],h[1].value=b.values[1],h.trigger("change")}})}else{var i=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:f,disabled:g,value:parseInt(i.val()),slide:function(a,b){i.val(b.value),i.trigger("change")}})}a(b).find(".ui-slider-handle").html('<i class="fa fa-navicon fa-rotate-90"></i>')}}),b.UI.register({wrapper:".afw-ui-component-spinner",getInput:function(b){return a(b).find("input")},init:function(b){var c=a(b).find("input"),d=c.attr("data-max"),e=c.attr("data-min"),f=c.attr("data-step"),g=c.attr("disabled");c.spinner({min:e,max:d,step:f,disabled:g}),a(b).find(".ui-spinner-down").detach().insertBefore(c),a(b).find(".ui-spinner-up").html('<i class="fa fa-chevron-right"></i>'),a(b).find(".ui-spinner-down").html('<i class="fa fa-chevron-left"></i>'),a(b).find(".ui-spinner-button").click(function(){c.trigger("change")})}}),jQuery(document).ready(function(a){a(".ao-field-switcher").children("label").click(function(){var b=[],c=a(this).parent(),d=c.children("input"),e=d.attr("disabled");e||(c.hasClass("singlevalue")&&c.find("label").removeClass("active"),a(this).toggleClass("active")),c.find(".active").each(function(){b.push(a(this).attr("data-value"))}),d.val(b),a(this).parents(".field-wrapper").trigger("change")})}),b.UI.register({wrapper:".afw-ui-component-text",getInput:function(b){return a(b).children("input")},init:function(){}}),b.UI.register({wrapper:".afw-ui-component-textarea",getInput:function(b){return a(b).children("textarea")},init:function(b){a(b).children("textarea").resizable({minHeight:150,minWidth:250}),a(b).find(".ui-resizable-s").html('<i class="fa fa-bars"></i>'),a(b).find(".ui-resizable-e").html('<i class="fa fa-bars fa-rotate-90"></i>')}}),b.UI.register({wrapper:".afw-ui-component-togglebutton",getInput:function(b){return a(b).children("input")},init:function(b){a(b).children("label").click(function(){var b=[],c=a(this).parent(),d=c.children("input");d.attr("disabled")||("false"===c.attr("data-multivalue")&&c.find("label").removeClass("active"),a(this).toggleClass("active"),c.find(".active").each(function(){b.push(a(this).attr("data-value"))}),d.val(b),d.trigger("change"))})}}),b.UI.init(),b.Options.init()});